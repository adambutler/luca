<%= turbo_frame_tag activity, :card, class: "block mb-5 w-full" do %>
  <%= polaris_card do %>
    <%= polaris_stack(vertical: true) do |stack| %>
      <% stack.with_item do %>
        <%= link_to activiy_card_collapsable_link(activity), data: {"turbo-action": "replace"} do %>
          <div class="flex">
            <div class="flex-shink mr-1">
              <%= polaris_icon do %>
                <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><title>ionicons-v5-q</title><line x1="48" y1="256" x2="464" y2="256" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><rect x="384" y="128" width="32" height="256" rx="16" ry="16" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><rect x="96" y="128" width="32" height="256" rx="16" ry="16" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><rect x="32" y="192" width="16" height="128" rx="8" ry="8" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><rect x="464" y="192" width="16" height="128" rx="8" ry="8" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/></svg>
              <% end %>
            </div>
            <p class="mb-2 font-bold"><%= activity.exercise.title %></p>
          </div>
          <p class="text-xs text-gray-700"><%= activity.exercise.description.truncate(params[:activity] == activity.id.to_s ? Float::INFINITY : 150) %></p>
        <% end %>

        <% if params[:activity] == activity.id.to_s %>
          <div class="grid grid-cols-12 gap-1 text-center mt-5 text-xs">
            <div class=""></div>
            <div class="col-span-5 font-black uppercase text-emerald-700">Load</div>
            <div class="col-span-5 font-black uppercase text-sky-700">Rep</div>
            <div class=""></div>
            
            <div class="pb-1 "></div>
            <div class="pb-1 col-span-2 font-semibold uppercase text-emerald-700">Goal</div>
            <div class="pb-1 "></div>
            <div class="pb-1 col-span-2 font-semibold uppercase text-emerald-700">Actual</div>
            <div class="pb-1 col-span-2 font-semibold uppercase text-sky-700">Goal</div>
            <div class="pb-1 "></div>
            <div class="pb-1 col-span-2 font-semibold uppercase text-sky-700">Actual</div>
            <div class="pb-1 "></div>

            <% activity.sets.each do |set| %>
              <div class="flex justify-center items-center">
                <%= link_to toggle_warmup_set_path(set), data: {"turbo-method": "put"} do %>
                  <% if set.warmup %>
                    <%= polaris_badge(status: :attention) { "W" } %>
                  <% else %>
                    <%= polaris_badge(status: :success) { set.set_number.to_s } %>
                  <% end %>
                <% end %>
              </div>
              <div class="flex justify-center items-center col-span-2">
                <%= form_with(model: set, url: set_path(set)) do |form| %>
                  <%= form.number_field :load_goal, value: set.load_goal&.prettify, step: "0.1", inputmode: "decimal", class: "w-full px-1 py-1 rounded bg-gray-50 border-gray-100 border font-semibold text-sm", onchange: "this.form.requestSubmit()" %>
                <% end %>
              </div>
              <div class="flex justify-center items-center">
                <%= form_with(model: set, url: set_path(set)) do |form| %>
                  <%= form.hidden_field :load_actual, value: set.load_goal %>
                  <button type="submit">
                    <%= polaris_icon(name: "CircleChevronRightMinor", color: :subdued) %>
                  </button>
                <% end %>
              </div>
              <div class="flex justify-center items-center col-span-2">
                <%= form_with(model: set, url: set_path(set)) do |form| %>
                  <%= form.number_field :load_actual, value: set.load_actual&.prettify, step: "0.1", inputmode: "decimal", class: "w-full px-1 py-1 rounded bg-gray-50 border-gray-100 border font-semibold text-sm", onchange: "this.form.requestSubmit()" %>
                <% end %>
              </div>
              <div class="flex justify-center items-center col-span-2">
                <%= form_with(model: set, url: set_path(set)) do |form| %>
                  <%= form.text_field :repetitions_goal, value: repetitions_goal_value(set), class: "w-full px-1 py-1 rounded bg-gray-50 border-gray-100 border font-semibold text-sm", onchange: "this.form.requestSubmit()" %>
                <% end %>
              </div>
              <div class="flex justify-center items-center">
                <% if can_copy_repetitions_actual_copy_value?(set) %>
                  <%= form_with(model: set, url: set_path(set)) do |form| %>
                    <%= form.hidden_field :repetitions_actual, value: repetitions_actual_copy_value(set) %>
                    <button type="submit">
                      <%= polaris_icon(name: "CircleChevronRightMinor", color: :subdued) %>
                    </button>
                  <% end %>
                <% end %>
              </div>
              <div class="flex justify-center items-center col-span-2">
                <%= form_with(model: set, url: set_path(set)) do |form| %>
                  <%= form.number_field :repetitions_actual, value: set.repetitions_actual, inputmode: "numeric", class: "w-full px-1 py-1 rounded bg-gray-50 border-gray-100 border font-semibold text-sm", onchange: "this.form.requestSubmit()" %>
                <% end %>
              </div>
              <div class="flex justify-center items-center">
                <%= link_to set_path(set), data: {"turbo-method": :delete}, class: "p-2" do |form| %>
                  <%= polaris_icon(name: "DeleteMinor", color: :critical) %>
                <% end %>
              </div>
            <% end %>
          </div>
        
          <%= form_with(model: activity.sets.build, url: activity_set_index_path(activity), class: "mt-5") do |form| %>
            <%= form.hidden_field :load_goal %>
            <%= form.hidden_field :repetitions_goal %>
            <%= form.hidden_field :warmup %>
            <%= form.hidden_field :repetitions_type %>
            <%= polaris_button(full_width: true, submit: true, primary: true) { "Add Set" } %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
