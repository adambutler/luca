<%= turbo_frame_tag activity, :card, class: "block mb-5" do %>
  <%= polaris_callout_card do |callout| %>
    <%= polaris_stack(vertical: true) do |stack| %>
      <% stack.with_item do %>
        <%= link_to activiy_card_collapsable_link(activity), data: {"turbo-action": "replace"} do %>
          <div class="flex">
            <div class="flex-shink mr-1">
              <%= polaris_icon do %>
                <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><title>ionicons-v5-q</title><line x1="48" y1="256" x2="464" y2="256" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><rect x="384" y="128" width="32" height="256" rx="16" ry="16" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><rect x="96" y="128" width="32" height="256" rx="16" ry="16" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><rect x="32" y="192" width="16" height="128" rx="8" ry="8" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/><rect x="464" y="192" width="16" height="128" rx="8" ry="8" style="fill:none;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"/></svg>
              <% end %>
            </div>
            <p class="mb-2 font-bold"><%= activity.exercise.title %></p>
          </div>
          <p class="text-xs text-gray-700"><%= activity.exercise.description %></p>
        <% end %>

        <% if params[:activity] == activity.id.to_s %>
          <table class="table-auto text-sm my-5">
            <thead class="text-xs uppercase">
              <tr>
                <th></th>
                <th colspan="2">Load</th>
                <th colspan="2">Rep</th>
                <th></th>
              </tr>
              <tr>
                <th></th>
                <th>Goal</th>
                <th>Actual</th>
                <th>Goal</th>
                <th>Actual</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% activity.sets.each do |set| %>
                <tr>
                  <td class="text-center p-1">
                    <%= link_to toggle_warmup_set_path(set), data: {"turbo-method": "put"} do %>
                      <% if set.warmup %>
                        <%= polaris_badge(status: :attention) { "W" } %>
                      <% else %>
                        <%= polaris_badge(status: :success) { set.set_number.to_s } %>
                      <% end %>
                    <% end %>
                  </td>
                  <td class="p-1">
                    <%= form_with(model: set, class: "contents", url: set_path(set)) do |form| %>
                      <%= form.number_field :load_goal, value: set.load_goal&.prettify, step: "0.1", class: "w-16 px-2 py-2 border-none rounded bg-gray-100 text-xs", onchange: "this.form.requestSubmit()" %>
                    <% end %>
                  </td>
                  <td class="p-1">
                    <%= form_with(model: set, class: "contents", url: set_path(set)) do |form| %>
                      <%= form.number_field :load_actual, value: set.load_actual&.prettify, step: "0.1", class: "w-16 px-2 py-2 border-none rounded bg-gray-100 text-xs", onchange: "this.form.requestSubmit()" %>
                    <% end %>
                  </td>
                  <td class="p-1">
                    <%= form_with(model: set, class: "contents", url: set_path(set)) do |form| %>
                      <%= form.text_field :repetitions_goal, value: repetitions_goal_value(set), class: "w-16 px-2 py-2 border-none rounded bg-gray-100 text-xs", onchange: "this.form.requestSubmit()" %>
                    <% end %>
                  </td>
                  <td class="p-1">
                    <%= form_with(model: set, class: "contents", url: set_path(set)) do |form| %>
                      <%= form.number_field :repetitions_actual, value: set.repetitions_actual, class: "w-16 px-2 py-2 border-none rounded bg-gray-100 text-xs", onchange: "this.form.requestSubmit()" %>
                    <% end %>
                  </td>
                  <td>
                    <%= form_with(model: set, class: "contents", url: set_path(set), method: :delete) do |form| %>
                      <%= polaris_icon(name: "DeleteMinor") %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
          <%= form_with(model: activity.sets.build, url: activity_set_index_path(activity)) do |form| %>
            <%= form.hidden_field :load_goal %>
            <%= form.hidden_field :repetitions_goal %>
            <%= form.hidden_field :warmup %>
            <%= form.hidden_field :repetitions_type %>
            <%= polaris_button(full_width: true, submit: true) { "Add Set" } %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
